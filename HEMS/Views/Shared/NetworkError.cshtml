@{
    ViewBag.Title = "Network Connection Issue";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-6">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-warning text-dark text-center py-3">
                    <i class="fas fa-wifi fa-2x mb-2"></i>
                    <h4 class="mb-0">Network Connection Issue</h4>
                </div>
                
                <div class="card-body p-4">
                    <!-- Main Error Message -->
                    <div class="alert alert-warning border-0 mb-4">
                        <div class="d-flex align-items-start">
                            <i class="fas fa-exclamation-triangle me-3 mt-1 text-warning"></i>
                            <div>
                                <h5 class="alert-heading mb-2">Network connectivity issue detected</h5>
                                <p class="mb-0">There appears to be a problem with your internet connection or the exam server is temporarily unreachable.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Connection Status -->
                    <div class="mb-4">
                        <h6 class="text-muted mb-3">Connection Status:</h6>
                        <div class="bg-light p-3 rounded">
                            <div class="d-flex align-items-center mb-2">
                                <div class="connection-indicator me-3" id="connectionStatus">
                                    <i class="fas fa-circle text-danger"></i>
                                </div>
                                <span id="connectionText">Checking connection...</span>
                            </div>
                            <small class="text-muted">Last checked: <span id="lastChecked">@DateTime.Now.ToString("HH:mm:ss")</span></small>
                        </div>
                    </div>

                    <!-- Troubleshooting Steps -->
                    <div class="mb-4">
                        <h6 class="text-muted mb-3">Troubleshooting Steps:</h6>
                        <div class="bg-light p-3 rounded">
                            <ol class="mb-0 small">
                                <li>Check your internet connection</li>
                                <li>Try refreshing the page</li>
                                <li>Ensure your WiFi or ethernet connection is stable</li>
                                <li>Close other applications that might be using bandwidth</li>
                                <li>Try switching to a different network if available</li>
                            </ol>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="d-grid gap-2 mb-4">
                        <button type="button" class="btn btn-primary" onclick="checkConnection()">
                            <i class="fas fa-sync-alt me-2"></i>Check Connection
                        </button>
                        
                        <button type="button" class="btn btn-outline-primary" onclick="window.location.reload()">
                            <i class="fas fa-redo me-2"></i>Retry
                        </button>
                        
                        <a href="@Url.Action("Index", "Home")" class="btn btn-outline-secondary">
                            <i class="fas fa-home me-2"></i>Return to Dashboard
                        </a>
                    </div>

                    <!-- Important Notice for Exam Takers -->
                    <div class="alert alert-info border-0">
                        <div class="d-flex align-items-start">
                            <i class="fas fa-info-circle me-3 mt-1 text-info"></i>
                            <div>
                                <h6 class="alert-heading mb-2">Important for Exam Takers:</h6>
                                <ul class="mb-0 small">
                                    <li><strong>Your answers are automatically saved</strong> when possible</li>
                                    <li>Network issues during an exam should be reported immediately</li>
                                    <li>Contact your exam coordinator if connection problems persist</li>
                                    <li>Do not close your browser - your progress is preserved</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Emergency Contact -->
                    <div class="alert alert-danger border-0">
                        <div class="d-flex align-items-start">
                            <i class="fas fa-exclamation-circle me-3 mt-1 text-danger"></i>
                            <div>
                                <h6 class="alert-heading mb-2">During an Exam?</h6>
                                <p class="mb-0">If you're experiencing network issues during an active exam, <strong>notify your exam coordinator immediately</strong>. Do not attempt to restart or leave the exam.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Timestamp -->
                    <div class="text-center mt-4 pt-3 border-top">
                        <small class="text-muted">
                            <i class="fas fa-clock me-1"></i>
                            Network issue detected at @DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss")
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Auto-retry functionality -->
<script>
    let retryCount = 0;
    const maxRetries = 5;
    
    function checkConnection() {
        const statusIndicator = document.getElementById('connectionStatus');
        const statusText = document.getElementById('connectionText');
        const lastChecked = document.getElementById('lastChecked');
        
        statusText.textContent = 'Checking connection...';
        statusIndicator.innerHTML = '<i class="fas fa-spinner fa-spin text-warning"></i>';
        
        // Simple connectivity check
        fetch('/Home/Index', { 
            method: 'HEAD',
            cache: 'no-cache',
            timeout: 5000
        })
        .then(response => {
            if (response.ok) {
                statusIndicator.innerHTML = '<i class="fas fa-circle text-success"></i>';
                statusText.textContent = 'Connection restored';
                lastChecked.textContent = new Date().toLocaleTimeString();
                
                // Show success message and offer to continue
                setTimeout(() => {
                    if (confirm('Connection has been restored. Would you like to return to your previous page?')) {
                        window.history.back();
                    }
                }, 1000);
            } else {
                throw new Error('Server responded with error');
            }
        })
        .catch(error => {
            statusIndicator.innerHTML = '<i class="fas fa-circle text-danger"></i>';
            statusText.textContent = 'Connection failed';
            lastChecked.textContent = new Date().toLocaleTimeString();
            
            retryCount++;
            if (retryCount < maxRetries) {
                setTimeout(checkConnection, 5000); // Retry after 5 seconds
            }
        });
    }
    
    // Auto-check connection every 30 seconds
    setInterval(checkConnection, 30000);
    
    // Initial connection check
    setTimeout(checkConnection, 1000);
</script>

<style>
    .card {
        max-width: 600px;
        margin: 0 auto;
    }
    
    .alert {
        border-radius: 8px;
    }
    
    .btn {
        border-radius: 6px;
        font-weight: 500;
    }
    
    .bg-light {
        background-color: #f8f9fa !important;
    }
    
    .border-top {
        border-top: 1px solid #dee2e6 !important;
    }
    
    .text-warning {
        color: #856404 !important;
    }
    
    .connection-indicator {
        width: 20px;
        text-align: center;
    }
    
    .fa-spinner {
        animation: fa-spin 1s infinite linear;
    }
    
    @@keyframes fa-spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
</style>