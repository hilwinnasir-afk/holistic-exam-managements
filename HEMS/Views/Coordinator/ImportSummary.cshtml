@model HEMS.Models.ViewModels.ImportSummaryViewModel
@{
    ViewBag.Title = "Import Summary";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container">
    <div class="row">
        <div class="col-md-12">
            <h2><i class="fas fa-chart-bar"></i> Import Summary</h2>
            <p class="lead">Results of student data import completed on @Model.ImportDate.ToString("MMMM dd, yyyy 'at' hh:mm tt")</p>
        </div>
    </div>

    <!-- Summary Statistics -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card bg-info text-white">
                <div class="card-body text-center">
                    <h3 class="card-title">@Model.TotalRecords</h3>
                    <p class="card-text">Total Records</p>
                    <i class="fas fa-file-alt fa-2x"></i>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-success text-white">
                <div class="card-body text-center">
                    <h3 class="card-title">@Model.SuccessfulImports</h3>
                    <p class="card-text">Successful</p>
                    <i class="fas fa-check-circle fa-2x"></i>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-danger text-white">
                <div class="card-body text-center">
                    <h3 class="card-title">@Model.FailedImports</h3>
                    <p class="card-text">Failed</p>
                    <i class="fas fa-times-circle fa-2x"></i>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-primary text-white">
                <div class="card-body text-center">
                    <h3 class="card-title">@(Model.TotalRecords > 0 ? Math.Round((double)Model.SuccessfulImports / Model.TotalRecords * 100, 1) : 0)%</h3>
                    <p class="card-text">Success Rate</p>
                    <i class="fas fa-percentage fa-2x"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- Import Results -->
    <div class="row">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0"><i class="fas fa-list"></i> Detailed Results</h5>
                    <div>
                        <button class="btn btn-sm btn-outline-success" onclick="showSuccessful()">
                            <i class="fas fa-check"></i> Show Successful (@Model.SuccessfulImports)
                        </button>
                        <button class="btn btn-sm btn-outline-danger" onclick="showFailed()">
                            <i class="fas fa-times"></i> Show Failed (@Model.FailedImports)
                        </button>
                        <button class="btn btn-sm btn-outline-secondary" onclick="showAll()">
                            <i class="fas fa-eye"></i> Show All
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    @if (Model.Results.Any())
                    {
                        <div class="table-responsive">
                            <table class="table table-striped table-hover" id="resultsTable">
                                <thead class="table-dark">
                                    <tr>
                                        <th>Status</th>
                                        <th>Student Name</th>
                                        <th>ID Number</th>
                                        <th>Gender</th>
                                        <th>Section</th>
                                        <th>University Email</th>
                                        <th>Batch Year (Form)</th>
                                        <th>Details</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var result in Model.Results)
                                    {
                                        <tr class="@(result.IsSuccess ? "success-row" : "failed-row")">
                                            <td>
                                                @if (result.IsSuccess)
                                                {
                                                    <span class="badge bg-success">
                                                        <i class="fas fa-check"></i> Success
                                                    </span>
                                                }
                                                else
                                                {
                                                    <span class="badge bg-danger">
                                                        <i class="fas fa-times"></i> Failed
                                                    </span>
                                                }
                                            </td>
                                            <td>@result.StudentName</td>
                                            <td>@result.IdNumber</td>
                                            <td>@result.Gender</td>
                                            <td>@result.Section</td>
                                            <td>@result.UniversityEmail</td>
                                            <td>@result.BatchYear</td>
                                            <td>
                                                @if (result.IsSuccess)
                                                {
                                                    <small class="text-success">
                                                        <i class="fas fa-user-plus"></i> 
                                                        User ID: @result.CreatedUserId, Student ID: @result.CreatedStudentId
                                                    </small>
                                                }
                                                else
                                                {
                                                    <small class="text-danger">
                                                        <i class="fas fa-exclamation-triangle"></i> 
                                                        @result.ErrorMessage
                                                    </small>
                                                }
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    }
                    else
                    {
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle"></i>
                            No import results to display.
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>

    <!-- Actions -->
    <div class="row mt-4">
        <div class="col-md-12">
            <div class="card">
                <div class="card-body text-center">
                    <h5 class="card-title">What's Next?</h5>
                    <div class="btn-group" role="group">
                        <a href="@Url.Action("ImportStudents", "Coordinator")" class="btn btn-primary">
                            <i class="fas fa-upload"></i> Import More Students
                        </a>
                        <a href="@Url.Action("ManageStudents", "Coordinator")" class="btn btn-success">
                            <i class="fas fa-users"></i> Manage Students
                        </a>
                        <a href="@Url.Action("Index", "Coordinator")" class="btn btn-secondary">
                            <i class="fas fa-tachometer-alt"></i> Back to Dashboard
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Individual Student -->
    <div class="row mt-4">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header bg-info text-white">
                    <h5 class="card-title mb-0"><i class="fas fa-user-plus"></i> Add Individual Student</h5>
                    <p class="mb-0 mt-2 opacity-75">Forgot a student during bulk import? Add them individually here.</p>
                </div>
                <div class="card-body">
                    @using (Html.BeginForm("AddIndividualStudent", "Coordinator", FormMethod.Post, new { @class = "form", role = "form" }))
                    {
                        @Html.AntiForgeryToken()
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label for="StudentName" class="form-label">Student Name</label>
                                    <input type="text" name="StudentName" class="form-control" placeholder="Full Name" required />
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label for="IdNumber" class="form-label">ID Number</label>
                                    <input type="text" name="IdNumber" class="form-control" placeholder="Student ID (leading zeros preserved)" required />
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group mb-3">
                                    <label for="Gender" class="form-label">Gender</label>
                                    <select name="Gender" class="form-control">
                                        <option value="">Select Gender</option>
                                        <option value="Male">Male</option>
                                        <option value="Female">Female</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group mb-3">
                                    <label for="Section" class="form-label">Section</label>
                                    <input type="text" name="Section" class="form-control" placeholder="e.g., A, B, C" />
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group mb-3">
                                    <label for="UniversityEmail" class="form-label">University Email</label>
                                    <input type="email" name="UniversityEmail" class="form-control" placeholder="student@haramaya.edu.et" required />
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label for="BatchYear" class="form-label">Batch Year</label>
                                    <input type="text" name="BatchYear" class="form-control" placeholder="e.g., Year IV Sem II" value="Year IV Sem II" required />
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group mb-3 d-flex align-items-end">
                                    <button type="submit" class="btn btn-info btn-lg">
                                        <i class="fas fa-user-plus"></i> Add Student
                                    </button>
                                </div>
                            </div>
                        </div>
                    }
                    
                    <div class="alert alert-info mt-3">
                        <i class="fas fa-info-circle"></i>
                        <strong>Note:</strong> The student will be immediately available for login after being added successfully.
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function showSuccessful() {
            $('#resultsTable tbody tr').hide();
            $('#resultsTable tbody tr.success-row').show();
        }

        function showFailed() {
            $('#resultsTable tbody tr').hide();
            $('#resultsTable tbody tr.failed-row').show();
        }

        function showAll() {
            $('#resultsTable tbody tr').show();
        }

        $(document).ready(function() {
            // Initialize with all rows visible
            showAll();
            
            // Add some styling for better UX
            $('.success-row').hover(
                function() { $(this).addClass('table-success'); },
                function() { $(this).removeClass('table-success'); }
            );
            
            $('.failed-row').hover(
                function() { $(this).addClass('table-danger'); },
                function() { $(this).removeClass('table-danger'); }
            );
        });
    </script>
}

<style>
    .card {
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        border: 1px solid rgba(0, 0, 0, 0.125);
    }
    
    .badge {
        font-size: 0.75em;
    }
    
    .table-responsive {
        max-height: 500px;
        overflow-y: auto;
    }
    
    .success-row {
        background-color: rgba(25, 135, 84, 0.1);
    }
    
    .failed-row {
        background-color: rgba(220, 53, 69, 0.1);
    }
    
    .btn-group .btn {
        margin: 0 2px;
    }
</style>